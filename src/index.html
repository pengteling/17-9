<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>文件上传监控</title>
		<style type="text/css">
			#box{background: cadetblue;height: 20px;}
			#box1{background: chocolate;height: 20px;width: 0px;}
		</style>
	</head>
	<body>
		<input type="file" id="fileInput" multiple />
		<p id="text"></p>
		<div id="box">
			<div id="box1"></div>
		</div>
		<button id="btn">中断</button>
		<script type="text/javascript">
			fileInput.onchange = function(){
				var file = this.files[0];
				
				var reader = new FileReader();
				
				
				//开始读取的时候触发
				reader.onloadstart = function(e){
					if(confirm('确定上传？')){
						//操作过程中触发
						reader.onprogress = function (e){
							console.log(e);
							//上传的大小和  总大小  
							if(e.loaded<e.total){
								var num = (e.loaded/e.total)*100;
								box1.style.width = num+"%";
								box1.innerHTML = "<span style='color:chartreuse'>正在上传！</span>";
							}else{
								//文件上传成功时触发
								reader.onload = function(e){
									if(e.loaded%e.total == 0){
										box1.style.width = 100+"%";
										box1.innerHTML = "<span style='color:green'>上传成功！</span>"
									}
								}
							}
							
						}
					}else{
						text.innerHTML = "<span style='color:blue'>放弃上传</span>"
					}
				}
				
				//中断操作
				function stopReader(e){
					reader.abort();
					box1.innerHTML = "<span style='color:crimson'>未知原因中断！</span>"
					
				}
				reader.onabort =stopReader;
				btn.onclick = stopReader;
				
				//获取二进制文的内容
				reader.readAsText(file,'utf-8')
			
				
				
			
				
			}
		</script>
		
	</body>
</html>
